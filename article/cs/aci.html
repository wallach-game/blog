<span>NumerÃ¡tor 16. 1. 2025</span>
<h3>
    Kontejnery v Azure a internÃ­ sÃ­Å¥ovÃ¡ komunikace.
</h3>
<p><small><small>
            TLDR: mÄ›jte vÅ¡e v kontejnerech, nebo pouÅ¾ijte Dapr nebo jinÃ½ message broker. InternÃ­
            komunikace z VM do kontejneru? MoÅ¾nÃ¡ funguje. S Äasem se zlepÅ¡Ã­ a dÅ™Ã­ve to podle vÅ¡eho
            fungovalo.
        </small></small>
    <br>
    <br>
    <small><small>Zkratky pouÅ¾itÃ©:<br>
            ACA â¡ï¸ Azure Container App<br>
            ACI â¡ï¸ Azure Container Instances
        </small></small>
</p>

<p>
    <big><big><big>K</big></big></big>dyÅ¾ mi zadali dockerizovat sluÅ¾bu, Å™ekl jsem si: â€SnadnÃ©. UÅ¾ jsem
    to dÄ›lal.â€œ O pÃ¡r tÃ½dnÅ¯ pozdÄ›ji jsem mÄ›l funkÄnÃ­ a otestovanÃ½ kontejner po portaci starÃ© aplikace
    .NET 4.3. Å½Ã¡dnÃ© exploze. SkvÄ›lÃ½ zaÄÃ¡tek.
</p>
<p>
    TÃ½m se seÅ¡el, aby otestoval komunikaci kontejneru s VM pÅ™es internet. Nebylo to hladkÃ©, ale po
    lehkÃ©m <em>â€popostrÄenÃ­â€œ</em> (tj. debugovÃ¡nÃ­) zaÄali komunikovat. Zapsali jsme si seznam ÃºkolÅ¯,
    dali si kÃ¡vu, poslali nÄ›co vlaÅ¾nÄ› optimistickÃ©ho CTO a Å¡li domÅ¯.
</p>
<p>
    Pak pÅ™iÅ¡la realita: <strong>Jak pÅ™imÄ›t VM, aby komunikovalo s kontejnerem pÅ™es internÃ­ sÃ­Å¥?</strong>
</p>

<h2>PrivÃ¡tnÃ­ komunikace: Peklo na zemi</h2>
<p>
    SluÅ¾ba byla nasazena jako Azure Container Apps (ACA). PÅ™epnutÃ­ prostÅ™edÃ­ ACA na privÃ¡tnÃ­ sÃ­Å¥ovÃ¡nÃ­ mi
    mi zobrazilo label <strong>(Preview).</strong> Co by se mohlo pokazit? UkÃ¡zalo se, Å¾e vÅ¡echno.
</p>
<p>
    PovolenÃ­ privÃ¡tnÃ­ho sÃ­Å¥ovÃ¡nÃ­ automaticky vytvoÅ™ilo novou skupinu zdrojÅ¯, ke kterÃ© jsem nemÄ›l
    pÅ™Ã­stup. RychlÃ¡ zprÃ¡va sprÃ¡vci systÃ©mu a mohl jsem pokraÄovat.
</p>
<p>
    Po pÃ¡r ÃºpravÃ¡ch jsem vidÄ›l slabou jiskru Å¾ivota s <code>tcpping</code> na portu sluÅ¾by. Curl? MrtvÃ½.
    ZmÄ›nil jsem porty. TeÄ uÅ¾ ani <code>tcpping</code> nefungoval. VrÃ¡til jsem je zpÄ›t. UÅ¾ ani <code>tcpping</code>
    nefunguje.
</p>
<p>
    V tu chvÃ­li jsem si kladl existenciÃ¡lnÃ­ otÃ¡zky.
</p>

<h2>GooglenÃ­ pro zachovÃ¡nÃ­ rozumu</h2>
<p>
    YouTube na zÃ¡chranu? Ne. JedinnÃ½ tutoriÃ¡l, kterÃ½ jsem naÅ¡el, byl dva roky starÃ½. Nakonec jsem narazil
    na oficiÃ¡lnÃ­ Microsoft nÃ¡vod, kterÃ½ byl mÄ›sÃ­c starÃ½. Haleluja! AÅ¾ na to, Å¾e byl neÃºplnÃ½, takÅ¾e jsem
    musel crossreferencovat CLI verzi, aby to zaÄlo â€fungovaloâ€œ.
</p>
<p>
    Nakonec se automaticky zaregistrovala internÃ­ URL kontejneru v privÃ¡tnÃ­ DNS zÃ³nÄ›. ÃšspÄ›ch? Ne. SluÅ¾ba stÃ¡le
    nefungovala. A kontejner zaÄal padat, protoÅ¾e postupovÃ¡nÃ­ podle <em>oficiÃ¡lnÃ­ch</em> krokÅ¯
    Microsoftu rozbilo komunikaci s Key Vaultem. Key Vault! ZÃ¡klad celÃ© sluÅ¾by. SkvÄ›lÃ©.
</p>

<h2>"StatickÃ©" IP adresy a ACI</h2>
<p>
    ZoufalÃ½, vyzkouÅ¡el jsem Azure Container Instances (ACI). Ty majÃ­ velmi mÃ¡lo funkcÃ­, Å¾Ã¡dnÃ©
    automatickÃ© aktualizace, Å¡kÃ¡lovÃ¡nÃ­ dle poÅ¾adavkÅ¯ atd. Tyto dostÃ¡vajÃ­ IP ze subnetu. PerfektnÃ­, ne?
    NE. StatickÃ© IP? ZapomeÅˆte. IP se mÄ›nÃ­ pÅ™i kaÅ¾dÃ©m restartu kontejneru.
</p>
<p>
    NejlepÅ¡Ã­ ÄÃ¡st? PotÅ™ebuji lokÃ¡lnÃ­ URL/IP kontejneru <em>pÅ™ed</em> spuÅ¡tÄ›nÃ­m sluÅ¾by. A jedinÃ½ zpÅ¯sob,
    jak ho zÃ­skat? Spustit kontejner a potÃ© se zeptat Azure CLI na jeho IP. SkvÄ›lÃ©.
</p>
<p>
    Tak jsem napsal rychlÃ½ bash skript s <code>jq</code>, kterÃ½ sebere IP a automaticky aktualizuje
    konfiguraÄnÃ­ soubor. Bylo to chytrÃ©? Ano. PÅ™ipadal jsem si, jako bych svÅ¯j projekt obalil lepicÃ­ pÃ¡skou?
    Taky ano.
</p>

<h2>ZÃ¡vÄ›reÄnÃ© myÅ¡lenky</h2>
<p>
    Jak tu sedÃ­m s pivem v ruce a pÅ™emÃ½Å¡lÃ­m o poslednÃ­ch dnech, zde je mÅ¯j verdikt:
</p>
<p>
    Ano, technicky je moÅ¾nÃ© to zprovoznit. Ale upÅ™Ã­mnÄ›? NestojÃ­ to za to. UÅ¡etÅ™ete si Äas, rozum a
    jÃ¡tra. BuÄ pÅ™ejdÄ›te kompletnÄ› na kontejnery, nebo pouÅ¾ijte Dapr. Cokoliv jinÃ©ho dopadne takto.
</p>
<p>
    Na zdravÃ­ pro pÅ™eÅ¾itÃ­ cloudu! ğŸ»
</p>